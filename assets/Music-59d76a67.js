import{_ as X,u as ne,s as q,r as p,c as w,o as oe,n as j,a as B,b as m,d as _,e as l,f as i,F as V,t as D,g as u,h as R,i as de,j as Re,k as le,w as N,l as De,m as z,p as ve,q as Ie,P as g,v as ce,x as H,y as $e,E as We,z as Ae,A as ie,B as Ne,K as Se,C as ue,D as Ve,G as ze}from"./index-7859e903.js";const Be="/assets/player_cover-75234800.png";const Xe={class:"music-info"},Ue=["src"],Ke={class:"hover",target:"_blank",href:"https://github.com/jianchuxin"},Fe={key:0},Ge={key:1},He={key:3},je={__name:"Lyric",props:{lyric:{type:Array,default:()=>[]},nolyric:{type:Boolean,default:!1},lyricIndex:{type:Number,default:0}},setup(f,{expose:h}){const r=ne(),{currentMusic:a}=q(r),o=f,t=p(0),L=w(()=>a.value.id&&a.value.image?`${a.value.image}?param=300y300`:Be),k=w(()=>`transform :translate3d(0,${-34*(o.lyricIndex-t.value)}px,0)`),c=p(null),d=()=>{const y=c.value,{display:P=""}=window.getComputedStyle(y);if(P==="none")return;const I=y.offsetHeight;t.value=Math.floor(I/34/2)};let b;return oe(()=>{window.addEventListener("resize",()=>{clearTimeout(b),b=setTimeout(()=>d(),60)}),j(()=>d())}),h({calcTop:d}),(y,P)=>{const I=B("ElectroIcon");return m(),_("div",null,[l("dl",Xe,[l("dt",null,[l("img",{src:L.value,alt:"img"},null,8,Ue)]),i(a).id?(m(),_(V,{key:0},[l("dd",null,"歌曲名："+D(i(a).name),1),l("dd",null,"歌手名："+D(i(a).singer),1),l("dd",null,"专辑名："+D(i(a).album),1)],64)):(m(),_(V,{key:1},[P[1]||(P[1]=l("dd",null,"Electro 在线播放器",-1)),l("dd",null,[l("a",Ke,[u(I,{type:"github",size:14}),P[0]||(P[0]=R(" merrickJ "))])])],64))]),l("div",{ref_key:"musicLyric",ref:c,class:"music-lyric"},[l("div",{class:"music-lyric-items",style:de(k.value)},[i(a).id?f.nolyric?(m(),_("p",Ge,"暂无歌词")):f.lyric.length>0?(m(!0),_(V,{key:2},Re(f.lyric,(x,M)=>(m(),_("p",{key:M,class:le({on:f.lyricIndex===M})},D(x.text),3))),128)):(m(),_("p",He,"歌词加载失败!")):(m(),_("p",Fe,"还没有播放音乐哦"))],4)],512)])}}},qe=X(je,[["__scopeId","data-v-730af842"]]);const Ye={class:"music-btn"},Je={__name:"MusicBtn",emits:["onClickLyric"],setup(f){return(h,r)=>{const a=B("RouterLink");return m(),_("div",Ye,[u(a,{to:"/music/playlist"},{default:N(()=>r[1]||(r[1]=[R("正在播放")])),_:1}),u(a,{to:"/music/toplist"},{default:N(()=>r[2]||(r[2]=[R("推荐")])),_:1}),u(a,{to:"/music/search"},{default:N(()=>r[3]||(r[3]=[R("搜索")])),_:1}),u(a,{to:"/music/userlist"},{default:N(()=>r[4]||(r[4]=[R("我的歌单")])),_:1}),l("span",{class:"show-960",onClick:r[0]||(r[0]=o=>h.$emit("onClickLyric"))},"歌词"),u(a,{to:"/music/historylist"},{default:N(()=>r[5]||(r[5]=[R("我听过的")])),_:1})])}}},Qe=X(Je,[["__scopeId","data-v-189e43ca"]]);const Ze={class:"electroProgress-inner"},A=10,et={__name:"ElectroProgress",props:{percent:{type:[Number],default:0},percentLoad:{type:[Number],default:0}},emits:["percentChange","percentChangeEnd"],setup(f,{emit:h}){const r=h,a=f,o=p({isDragging:!1,startX:0,left:0}),t=p(null),L=p(null),k=p(null);oe(()=>{c();const n=t.value.clientWidth-A,v=a.percent*n;b(v)}),De(()=>{d()});const c=()=>{document.addEventListener("mousemove",x),document.addEventListener("mouseup",M),document.addEventListener("touchmove",x),document.addEventListener("touchend",M)},d=()=>{document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",M),document.removeEventListener("touchmove",x),document.removeEventListener("touchend",M)},b=n=>{L.value.style.width=n+"px"},y=(n=!1)=>{const v=t.value.clientWidth-A,C=L.value.clientWidth/v;r(n?"percentChangeEnd":"percentChange",C)};z(()=>a.percent,n=>{if(n>=0&&!o.value.isDragging){const v=t.value.clientWidth-A,C=n*v;b(C)}}),z(()=>a.percentLoad,n=>{const v=t.value.clientWidth-A,C=n*v;k.value.style.width=C+"px"});const P=n=>{const v=L.value.getBoundingClientRect(),C=Math.min(t.value.clientWidth-A,Math.max(0,n.clientX-v.left));b(C),y(!0)},I=n=>{o.value.isDragging=!0,o.value.startX=n.clientX||n.touches[0].pageX,o.value.left=L.value.clientWidth},x=n=>{if(!o.value.isDragging)return;n.preventDefault();let C=(n.clientX||n.touches[0].pageX)-o.value.startX,Y=Math.min(t.value.clientWidth-A,Math.max(0,o.value.left+C));b(Y),y()},M=()=>{o.value.isDragging&&(y(!0),o.value.isDragging=!1)};return(n,v)=>(m(),_("div",{ref_key:"electroProgress",ref:t,class:"electroProgress",onClick:P},[l("div",Ze,[l("div",{ref_key:"electroProgressLoad",ref:k,class:"electroProgress-load"},null,512),l("div",{ref_key:"electroProgressPlay",ref:L,class:"electroProgress-play"},[l("div",{class:"electroProgress-dot",onMousedown:I},null,32)],512)])],512))}},me=X(et,[["__scopeId","data-v-a987bf1b"]]);const tt={class:"volume"},st={class:"volume-progress-wrapper"},lt={__name:"Volume",props:{volume:{type:Number,required:!0}},emits:["volumeChange"],setup(f,{emit:h}){const r=f,a=h,o=p(r.volume),t=w(()=>r.volume),L=w(()=>t.value?"turnon":"turnoff"),k=()=>{let d;t.value?(d=0,o.value=t.value):d=o.value,c(d)},c=d=>{a("volumeChange",d)};return(d,b)=>{const y=B("ElectroIcon");return m(),_("div",tt,[u(y,{class:"pointer volume-icon",type:L.value,size:30,onClick:k},null,8,["type"]),l("div",st,[u(me,{percent:t.value,onPercentChangeEnd:c,onPercentChange:c},null,8,["percent"])])])}}},nt=X(lt,[["__scopeId","data-v-2a5af446"]]),pe=ne(),{setPlaying:te}=pe,{audioEle:E,currentMusic:se}=q(pe),ot=ve(),{addHistoryMusic:rt}=ot,at=()=>{const f=p(!1),h=p(0),r=p(0);return{musicReady:f,currentTime:h,currentMusic:se,currentProgress:r,initAudio:()=>{E.value.onplay=()=>{let o;clearTimeout(o),o=setTimeout(()=>{f.value=!0},100)},E.value.onprogress=()=>{try{if(E.value.buffered.length>0){const o=se.value.duration;let t=0;t=E.value.buffered.end(0)>o?o:E.value.buffered.end(0),r.value=t/o}}catch(o){console.log(o)}},E.onpause=()=>{te(!1)},E.value.ontimeupdate=()=>{h.value=E.value.currentTime},E.value.oncanplay=()=>{rt(se.value)},E.onstalled=()=>{E.load(),te(!1);let o;clearTimeout(o),o=setTimeout(()=>{te(!0)},10)}}}};const ct={class:"music flex-col"},it={class:"music-content"},ut={class:"music-left flex-col"},dt={class:"music-bar-btns"},vt={class:"control-play pointer",title:"播放暂停 Ctrl + Space"},mt={class:"music-music"},pt={class:"music-bar-info"},yt={key:0,class:"music-bar-time"},_t={class:"options"},ft={class:"music-bar-volume",title:"音量加减 [Ctrl + Up / Down]"},gt={__name:"Music",setup(f){const h=ne(),{setCurrentIndex:r,setPlaying:a,setMode:o}=h,{currentMusic:t,currentIndex:L,isPlaying:k,audioEle:c,playList:d,orderList:b,mode:y}=q(h),P=ve(),{setVolume:I}=P,{volume:x}=q(P),M=p(!1),{musicReady:n,currentTime:v,currentProgress:C,initAudio:Y}=at(),$=p([]),J=p(!1),U=p(!1),S=p(0),Q=p(null),K=p(!1),ye=()=>{K.value=!K.value,j(()=>{Q.value.calcTop()})},_e=w(()=>K.value?"pureopen":"pureclose"),fe=Ie();oe(()=>{Y(),c.value.onended=()=>{y.value===g.ONE_LOOP?ee():F()},c.value.onerror=()=>{let e="当前音乐不可播放，已自动播放下一首";d.value.length===1&&(e="暂时没有可播放的音乐哦~"),ce({message:e}),F()},Te()});const ge=w(()=>t.value.id&&t.value.image?`${t.value.image}?param=300y300`:We.BACKGROUND),he=w(()=>{const e=t.value.duration;return v.value&&e?v.value/e:0}),Le=w(()=>({[g.LIST_LOOP]:"listloop",[g.ORDER]:"order",[g.RANDOM]:"random",[g.ONE_LOOP]:"oneloop"})[y.value]),ke=w(()=>{const e="Ctrl + O";return{[g.LIST_LOOP]:"列表循环",[g.ORDER]:"顺序播放",[g.RANDOM]:"随机播放",[g.ONE_LOOP]:"单曲循环"}[y.value]+" "+e});z(t,(e,s)=>{if(!e.id){$.value=[];return}e.id!==s.id&&(c.value.src=e.url,S.value=v.value=C.value=0,H(c.value.play()),we(e.id))}),z(k,e=>{const s=c.value;j(()=>{e?H(s.play()):s.pause(),n.value=!0})}),z(v,(e,s)=>{if(U.value||$.value.length===0)return;let O=0,T=$.value.length-1,W=S.value;e>s?O=W:T=W;for(let G=O;G<=T;G++)$.value[G].time<e&&(W=G);S.value=W});const Z=e=>{M.value=e===0,c.value.volume=e,I(e)},Ce=e=>{v.value=t.value.duration*e},be=e=>{c.value.currentTime=t.value.duration*e},Pe=()=>{const e=(y.value+1)%4;if(o(e),e===g.ONE_LOOP)return;let s=[];switch(e){case g.LIST_LOOP:case g.ORDER:s=b.value;break;case g.RANDOM:s=Ae(b.value);break}Me(s),d.value=s},Ee=()=>{J.value=!0,j(()=>{Q.value.calcTop()})},xe=()=>{J.value=!1},Oe=()=>{if(!t.value.id){ce({message:"还没有播放音乐哦",position:"bottom"});return}fe.push(`/music/comment/${t.value.id}`)},Me=e=>{const s=e.findIndex(O=>O.id===t.value.id);r(s)},re=()=>{if(n.value)if(d.value.length===1)ee();else{let e=L.value-1;e<0&&(e=d.value.length-1),r(e),!k.value&&n.value&&a(!0),n.value=!1}},ae=()=>{n.value&&a(!k.value)},F=(e=!1)=>{if(!n.value)return;const s=d.value.length;if(s-1===L.value&&y.value===g.ORDER||s===1&&e){r(-1),a(!1);return}if(s===1)ee();else{let O=L.value+1;O===s&&(O=0),!k.value&&n.value&&a(!0),r(O),n.value=!1}},ee=()=>{c.value.currentTime=0,H(c.value.play()),a(!0),$.value.length>0&&(S.value=0)},Te=()=>{document.onkeydown=e=>{if(e.ctrlKey)switch(e.key){case" ":ae();break;case"ArrowLeft":re();break;case"ArrowRight":F();break;case"ArrowUp":{let s=x.value+.1;s>1&&(s=1),Z(s);break}case"ArrowDown":{let s=x.value-.1;s<0&&(s=0),Z(s);break}}}},we=async e=>{const s=await Ve(e);s.lrc&&s.lrc.lyric?(U.value=!1,$.value=ze(s.lrc.lyric)):U.value=!0,H(c.value.play())};return(e,s)=>{const O=B("RouterView"),T=B("ElectroIcon");return m(),_("div",ct,[l("div",it,[l("div",ut,[u(Qe,{onOnClickLyric:Ee}),u(O,{class:"router-view"},{default:N(({Component:W})=>[(m(),ie(Se,{exclude:"Details,HistoryList,Comment"},[(m(),ie(Ne(W)))],1024))]),_:1})]),l("div",{class:le(["music-right",{show:J.value,pure:K.value}])},[l("div",{class:"close-lyric",onClick:xe},"关闭歌词"),u(qe,{ref_key:"electroLyric",ref:Q,lyric:$.value,nolyric:U.value,"lyric-index":S.value},null,8,["lyric","nolyric","lyric-index"])],2)]),l("div",{class:le(["music-bar",{disabled:!i(n)||!i(t).id}])},[l("div",dt,[u(T,{type:"prev",size:24,class:"pointer",title:"上一曲 Ctrl + Left",onClick:re}),l("div",vt,[u(T,{type:i(k)?"pause-bold":"play-bold",size:20,onClick:ae},null,8,["type"])]),u(T,{type:"next",size:24,class:"pointer",title:"下一曲 Ctrl + Right",onClick:F})]),l("div",mt,[l("div",pt,[i(t)&&i(t).id?(m(),_(V,{key:0},[R(D(i(t).name)+" ",1),l("span",null,"-"+D(i(t).singer),1)],64)):(m(),_(V,{key:1},[R("欢迎使用 Electro 在线音乐播放器")],64))]),i(t).id?(m(),_("div",yt,D(i(ue)(i(v)))+"/"+D(i(ue)(i(t).duration%3600)),1)):$e("",!0),u(me,{class:"music-progress",percent:he.value,"percent-load":i(C),onPercentChange:Ce,onPercentChangeEnd:be},null,8,["percent","percent-load"])]),l("div",_t,[u(T,{class:"pointer mode",type:Le.value,title:ke.value,size:24,onClick:Pe},null,8,["type","title"]),u(T,{class:"pointer comment",onClick:Oe,type:"comment",title:"评论",size:24}),u(T,{class:"pointer pure-mode",onClick:ye,type:_e.value,title:"纯净模式",size:28},null,8,["type"]),l("div",ft,[u(nt,{volume:i(x),onVolumeChange:Z},null,8,["volume"])])])],2),l("div",{class:"electroPlayer-bg",style:de({backgroundImage:"url("+ge.value+")"})},null,4),s[0]||(s[0]=l("div",{class:"electroPlayer-mask"},null,-1))])}}},Lt=X(gt,[["__scopeId","data-v-954c0d01"]]);export{Lt as default};
