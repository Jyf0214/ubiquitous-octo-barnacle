import{_ as B,u as le,s as q,r as p,c as w,o as oe,n as j,a as z,b as m,d as f,e as o,f as d,F as N,t as T,g as v,h as I,i as ue,j as De,k as se,p as de,l as ve,w as W,m as $e,q as V,v as me,x as Se,P as g,y as ce,z as G,A as We,E as Ae,B as Ne,C as re,D as Ve,K as ze,G as ie,H as Be,I as Xe}from"./index-6bb17dc0.js";const Ue="/assets/player_cover-75234800.png";const Ke=c=>(de("data-v-730af842"),c=c(),ve(),c),He={class:"music-info"},Fe=["src"],Ge=Ke(()=>o("dd",null,"Electro 在线播放器",-1)),je={class:"hover",target:"_blank",href:"https://github.com/jianchuxin"},qe={key:0},Ye={key:1},Je={key:3},Qe={__name:"Lyric",props:{lyric:{type:Array,default:()=>[]},nolyric:{type:Boolean,default:!1},lyricIndex:{type:Number,default:0}},setup(c,{expose:h}){const u=c,n=le(),{currentMusic:t}=q(n),s=p(0),P=w(()=>t.value.id&&t.value.image?`${t.value.image}?param=300y300`:Ue),L=w(()=>`transform :translate3d(0,${-34*(u.lyricIndex-s.value)}px,0)`),r=p(null),y=()=>{const C=r.value,{display:R=""}=window.getComputedStyle(C);if(R==="none")return;const E=C.offsetHeight;s.value=Math.floor(E/34/2)};let k;return oe(()=>{window.addEventListener("resize",()=>{clearTimeout(k),k=setTimeout(()=>y(),60)}),j(()=>y())}),h({calcTop:y}),(C,R)=>{const E=z("ElectroIcon");return m(),f("div",null,[o("dl",He,[o("dt",null,[o("img",{src:P.value,alt:"img"},null,8,Fe)]),d(t).id?(m(),f(N,{key:0},[o("dd",null,"歌曲名："+T(d(t).name),1),o("dd",null,"歌手名："+T(d(t).singer),1),o("dd",null,"专辑名："+T(d(t).album),1)],64)):(m(),f(N,{key:1},[Ge,o("dd",null,[o("a",je,[v(E,{type:"github",size:14}),I(" merrickJ ")])])],64))]),o("div",{ref_key:"musicLyric",ref:r,class:"music-lyric"},[o("div",{class:"music-lyric-items",style:ue(L.value)},[d(t).id?c.nolyric?(m(),f("p",Ye,"暂无歌词")):c.lyric.length>0?(m(!0),f(N,{key:2},De(c.lyric,(x,a)=>(m(),f("p",{key:a,class:se({on:c.lyricIndex===a})},T(x.text),3))),128)):(m(),f("p",Je,"歌词加载失败!")):(m(),f("p",qe,"还没有播放音乐哦"))],4)],512)])}}},Ze=B(Qe,[["__scopeId","data-v-730af842"]]);const et={class:"music-btn"},tt={__name:"MusicBtn",emits:["onClickLyric"],setup(c){return(h,u)=>{const n=z("RouterLink");return m(),f("div",et,[v(n,{to:"/music/playlist"},{default:W(()=>[I("正在播放")]),_:1}),v(n,{to:"/music/toplist"},{default:W(()=>[I("推荐")]),_:1}),v(n,{to:"/music/search"},{default:W(()=>[I("搜索")]),_:1}),v(n,{to:"/music/userlist"},{default:W(()=>[I("我的歌单")]),_:1}),o("span",{class:"show-960",onClick:u[0]||(u[0]=t=>h.$emit("onClickLyric"))},"歌词"),v(n,{to:"/music/historylist"},{default:W(()=>[I("我听过的")]),_:1})])}}},st=B(tt,[["__scopeId","data-v-189e43ca"]]);const lt={class:"electroProgress-inner"},S=10,ot={__name:"ElectroProgress",props:{percent:{type:[Number],default:0},percentLoad:{type:[Number],default:0}},emits:["percentChange","percentChangeEnd"],setup(c,{emit:h}){const u=c,n=p({isDragging:!1,startX:0,left:0}),t=p(null),s=p(null),P=p(null);oe(()=>{L();const a=t.value.clientWidth-S,i=u.percent*a;y(i)}),$e(()=>{r()});const L=()=>{document.addEventListener("mousemove",E),document.addEventListener("mouseup",x),document.addEventListener("touchmove",E),document.addEventListener("touchend",x)},r=()=>{document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",x),document.removeEventListener("touchmove",E),document.removeEventListener("touchend",x)},y=a=>{s.value.style.width=a+"px"},k=(a=!1)=>{const i=t.value.clientWidth-S,_=s.value.clientWidth/i;h(a?"percentChangeEnd":"percentChange",_)};V(()=>u.percent,a=>{if(a>=0&&!n.value.isDragging){const i=t.value.clientWidth-S,_=a*i;y(_)}}),V(()=>u.percentLoad,a=>{const i=t.value.clientWidth-S,_=a*i;P.value.style.width=_+"px"});const C=a=>{const i=s.value.getBoundingClientRect(),_=Math.min(t.value.clientWidth-S,Math.max(0,a.clientX-i.left));y(_),k(!0)},R=a=>{n.value.isDragging=!0,n.value.startX=a.clientX||a.touches[0].pageX,n.value.left=s.value.clientWidth},E=a=>{if(!n.value.isDragging)return;a.preventDefault();let _=(a.clientX||a.touches[0].pageX)-n.value.startX,X=Math.min(t.value.clientWidth-S,Math.max(0,n.value.left+_));y(X),k()},x=()=>{n.value.isDragging&&(k(!0),n.value.isDragging=!1)};return(a,i)=>(m(),f("div",{ref_key:"electroProgress",ref:t,class:"electroProgress",onClick:C},[o("div",lt,[o("div",{ref_key:"electroProgressLoad",ref:P,class:"electroProgress-load"},null,512),o("div",{ref_key:"electroProgressPlay",ref:s,class:"electroProgress-play"},[o("div",{class:"electroProgress-dot",onMousedown:R},null,32)],512)])],512))}},pe=B(ot,[["__scopeId","data-v-a987bf1b"]]);const nt={class:"volume"},at={class:"volume-progress-wrapper"},ct={__name:"Volume",props:{volume:{type:Number,required:!0}},emits:["volumeChange"],setup(c,{emit:h}){const u=c,n=p(u.volume),t=w(()=>u.volume),s=w(()=>t.value?"turnon":"turnoff"),P=()=>{let r;t.value?(r=0,n.value=t.value):r=n.value,L(r)},L=r=>{h("volumeChange",r)};return(r,y)=>{const k=z("ElectroIcon");return m(),f("div",nt,[v(k,{class:"pointer volume-icon",type:s.value,size:30,onClick:P},null,8,["type"]),o("div",at,[v(pe,{percent:t.value,onPercentChangeEnd:L,onPercentChange:L},null,8,["percent"])])])}}},rt=B(ct,[["__scopeId","data-v-2a5af446"]]),_e=le(),{setPlaying:ee}=_e,{audioEle:b,currentMusic:te}=q(_e),it=me(),{addHistoryMusic:ut}=it,dt=()=>{const c=p(!1),h=p(0),u=p(0);return{musicReady:c,currentTime:h,currentMusic:te,currentProgress:u,initAudio:()=>{b.value.onplay=()=>{let t;clearTimeout(t),t=setTimeout(()=>{c.value=!0},100)},b.value.onprogress=()=>{try{if(b.value.buffered.length>0){const t=te.value.duration;let s=0;s=b.value.buffered.end(0)>t?t:b.value.buffered.end(0),u.value=s/t}}catch(t){console.log(t)}},b.onpause=()=>{ee(!1)},b.value.ontimeupdate=()=>{h.value=b.value.currentTime},b.value.oncanplay=()=>{ut(te.value)},b.onstalled=()=>{b.load(),ee(!1);let t;clearTimeout(t),t=setTimeout(()=>{ee(!0)},10)}}}};const vt=c=>(de("data-v-954c0d01"),c=c(),ve(),c),mt={class:"music flex-col"},pt={class:"music-content"},_t={class:"music-left flex-col"},yt={class:"music-bar-btns"},ft={class:"control-play pointer",title:"播放暂停 Ctrl + Space"},gt={class:"music-music"},ht={class:"music-bar-info"},Lt={key:0,class:"music-bar-time"},kt={class:"options"},Ct={class:"music-bar-volume",title:"音量加减 [Ctrl + Up / Down]"},bt=vt(()=>o("div",{class:"electroPlayer-mask"},null,-1)),Pt={__name:"Music",setup(c){const h=le(),{setCurrentIndex:u,setPlaying:n,setMode:t}=h,{currentMusic:s,currentIndex:P,isPlaying:L,audioEle:r,playList:y,orderList:k,mode:C}=q(h),R=me(),{setVolume:E}=R,{volume:x}=q(R),a=p(!1),{musicReady:i,currentTime:_,currentProgress:X,initAudio:ye}=dt(),D=p([]),Y=p(!1),U=p(!1),A=p(0),J=p(null),K=p(!1),fe=()=>{K.value=!K.value,j(()=>{J.value.calcTop()})},ge=w(()=>K.value?"pureopen":"pureclose"),he=Se();oe(()=>{ye(),r.value.onended=()=>{C.value===g.ONE_LOOP?Z():H()},r.value.onerror=()=>{let e="当前音乐不可播放，已自动播放下一首";y.value.length===1&&(e="暂时没有可播放的音乐哦~"),ce({message:e}),H()},Te()});const Le=w(()=>s.value.id&&s.value.image?`${s.value.image}?param=300y300`:Ae.BACKGROUND),ke=w(()=>{const e=s.value.duration;return _.value&&e?_.value/e:0}),Ce=w(()=>({[g.LIST_LOOP]:"listloop",[g.ORDER]:"order",[g.RANDOM]:"random",[g.ONE_LOOP]:"oneloop"})[C.value]),be=w(()=>{const e="Ctrl + O";return{[g.LIST_LOOP]:"列表循环",[g.ORDER]:"顺序播放",[g.RANDOM]:"随机播放",[g.ONE_LOOP]:"单曲循环"}[C.value]+" "+e});V(s,(e,l)=>{if(!e.id){D.value=[];return}e.id!==l.id&&(r.value.src=e.url,A.value=_.value=X.value=0,G(r.value.play()),Re(e.id))}),V(L,e=>{const l=r.value;j(()=>{e?G(l.play()):l.pause(),i.value=!0})}),V(_,(e,l)=>{if(U.value||D.value.length===0)return;let O=0,M=D.value.length-1,$=A.value;e>l?O=$:M=$;for(let F=O;F<=M;F++)D.value[F].time<e&&($=F);A.value=$});const Q=e=>{a.value=e===0,r.value.volume=e,E(e)},Pe=e=>{_.value=s.value.duration*e},Ee=e=>{r.value.currentTime=s.value.duration*e},xe=()=>{const e=(C.value+1)%4;if(t(e),e===g.ONE_LOOP)return;let l=[];switch(e){case g.LIST_LOOP:case g.ORDER:l=k.value;break;case g.RANDOM:l=Ne(k.value);break}Ie(l),y.value=l},Oe=()=>{Y.value=!0,j(()=>{J.value.calcTop()})},Me=()=>{Y.value=!1},we=()=>{if(!s.value.id){ce({message:"还没有播放音乐哦",position:"bottom"});return}he.push(`/music/comment/${s.value.id}`)},Ie=e=>{const l=e.findIndex(O=>O.id===s.value.id);u(l)},ne=()=>{if(i.value)if(y.value.length===1)Z();else{let e=P.value-1;e<0&&(e=y.value.length-1),u(e),!L.value&&i.value&&n(!0),i.value=!1}},ae=()=>{i.value&&n(!L.value)},H=(e=!1)=>{if(!i.value)return;const l=y.value.length;if(l-1===P.value&&C.value===g.ORDER||l===1&&e){u(-1),n(!1);return}if(l===1)Z();else{let O=P.value+1;O===l&&(O=0),!L.value&&i.value&&n(!0),u(O),i.value=!1}},Z=()=>{r.value.currentTime=0,G(r.value.play()),n(!0),D.value.length>0&&(A.value=0)},Te=()=>{document.onkeydown=e=>{if(e.ctrlKey)switch(e.key){case" ":ae();break;case"ArrowLeft":ne();break;case"ArrowRight":H();break;case"ArrowUp":{let l=x.value+.1;l>1&&(l=1),Q(l);break}case"ArrowDown":{let l=x.value-.1;l<0&&(l=0),Q(l);break}}}},Re=async e=>{const l=await Be(e);l.lrc&&l.lrc.lyric?(U.value=!1,D.value=Xe(l.lrc.lyric)):U.value=!0,G(r.value.play())};return(e,l)=>{const O=z("RouterView"),M=z("ElectroIcon");return m(),f("div",mt,[o("div",pt,[o("div",_t,[v(st,{onOnClickLyric:Oe}),v(O,{class:"router-view"},{default:W(({Component:$})=>[(m(),re(ze,{exclude:"Details,HistoryList,Comment"},[(m(),re(Ve($)))],1024))]),_:1})]),o("div",{class:se(["music-right",{show:Y.value,pure:K.value}])},[o("div",{class:"close-lyric",onClick:Me},"关闭歌词"),v(Ze,{ref_key:"electroLyric",ref:J,lyric:D.value,nolyric:U.value,"lyric-index":A.value},null,8,["lyric","nolyric","lyric-index"])],2)]),o("div",{class:se(["music-bar",{disabled:!d(i)||!d(s).id}])},[o("div",yt,[v(M,{type:"prev",size:24,class:"pointer",title:"上一曲 Ctrl + Left",onClick:ne}),o("div",ft,[v(M,{type:d(L)?"pause-bold":"play-bold",size:20,onClick:ae},null,8,["type"])]),v(M,{type:"next",size:24,class:"pointer",title:"下一曲 Ctrl + Right",onClick:H})]),o("div",gt,[o("div",ht,[d(s)&&d(s).id?(m(),f(N,{key:0},[I(T(d(s).name)+" ",1),o("span",null,"-"+T(d(s).singer),1)],64)):(m(),f(N,{key:1},[I("欢迎使用 Electro 在线音乐播放器")],64))]),d(s).id?(m(),f("div",Lt,T(d(ie)(d(_)))+"/"+T(d(ie)(d(s).duration%3600)),1)):We("",!0),v(pe,{class:"music-progress",percent:ke.value,"percent-load":d(X),onPercentChange:Pe,onPercentChangeEnd:Ee},null,8,["percent","percent-load"])]),o("div",kt,[v(M,{class:"pointer mode",type:Ce.value,title:be.value,size:24,onClick:xe},null,8,["type","title"]),v(M,{class:"pointer comment",onClick:we,type:"comment",title:"评论",size:24}),v(M,{class:"pointer pure-mode",onClick:fe,type:ge.value,title:"纯净模式",size:28},null,8,["type"]),o("div",Ct,[v(rt,{volume:d(x),onVolumeChange:Q},null,8,["volume"])])])],2),o("div",{class:"electroPlayer-bg",style:ue({backgroundImage:"url("+Le.value+")"})},null,4),bt])}}},xt=B(Pt,[["__scopeId","data-v-954c0d01"]]);export{xt as default};
